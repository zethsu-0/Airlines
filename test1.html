<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Seat Picker Modal with Cabin Filter</title>

  <!-- Materialize CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet"/>

  <style>
    .seat-map {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px;
      max-width: 960px;
      margin: 0 auto;
    }

    .seat-row {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }

    .row-label {
      width: 44px;
      min-width: 44px;
      text-align: center;
      font-weight: 600;
      color: #444;
    }

    .seat {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      border: 1px solid rgba(0,0,0,0.12);
      transition: transform .08s ease, box-shadow .12s ease;
      background: #fff;
      font-weight: 600;
    }
    .seat:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }

    .seat.selected {
      color: white;
      border-color: rgba(0,0,0,0.15);
    }

    .seat.disabled {
      background: #efefef;
      color: #9e9e9e;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .aisle {
      width: 28px;
      min-width: 28px;
    }

    .legend {
      display:flex;
      gap:12px;
      align-items:center;
      margin: 8px 16px 18px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .legend .box {
      width:18px;height:18px;border-radius:4px;border:1px solid rgba(0,0,0,0.12);
      display:inline-block;vertical-align:middle;margin-right:6px;
    }
    .legend .box.selected { background:#26a69a; border:none; }
    .legend .box.disabled { background:#efefef; color:#9e9e9e; border:none; }

    .selection-summary {
      margin-top: 12px;
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 16px 16px;
    }

    .cabin-header {
      margin-top: 10px;
      margin-bottom: 4px;
      text-align: left;
      max-width: 960px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 18px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .cabin-header h6 {
      margin: 0;
      font-weight: 600;
    }
    .cabin-header .line {
      flex:1;
      height: 1px;
      background: rgba(0,0,0,0.12);
    }

    /* Cabin colors (normal) */
    .seat.first    { background-color: #e3f2fd; }  /* light blue */
    .seat.business { background-color: #fff3e0; }  /* light orange */
    .seat.premium  { background-color: #ede7f6; }  /* light purple */
    .seat.economy  { background-color: #e8f5e9; }  /* light green */

    /* Cabin colors (selected) */
    .seat.first.selected    { background-color: #1e88e5; }
    .seat.business.selected { background-color: #fb8c00; }
    .seat.premium.selected  { background-color: #7e57c2; }
    .seat.economy.selected  { background-color: #43a047; }

    /* Cabin header colors */
    .cabin-header.first h6    { color: #1e88e5; }
    .cabin-header.business h6 { color: #fb8c00; }
    .cabin-header.premium h6  { color: #7e57c2; }
    .cabin-header.economy h6  { color: #43a047; }

    @media (max-width:680px) {
      .seat { width:36px; height:36px; border-radius:6px; }
      .row-label { width:36px; min-width:36px; font-size:0.9rem; }
    }

    .modal.modal-fixed-footer {
      max-height: 90%;
    }
  </style>
</head>
<body class="grey lighten-4">

  <!-- Cabin filter + modal trigger (OUTSIDE modal) -->
  <div class="container" style="margin-top:40px;">
    <div class="row center">
      <div class="col s12">
        <p><strong>Select cabin to display:</strong></p>
        <p>
          <label>
            <input class="with-gap" name="cabinFilter" type="radio" value="all" checked />
            <span>All cabins</span>
          </label>
        </p>
        <p>
          <label>
            <input class="with-gap" name="cabinFilter" type="radio" value="first" />
            <span>First Class</span>
          </label>
          <label style="margin-left:18px;">
            <input class="with-gap" name="cabinFilter" type="radio" value="business" />
            <span>Business Class</span>
          </label>
        </p>
        <p>
          <label>
            <input class="with-gap" name="cabinFilter" type="radio" value="premium" />
            <span>Premium Economy</span>
          </label>
          <label style="margin-left:18px;">
            <input class="with-gap" name="cabinFilter" type="radio" value="economy" />
            <span>Economy</span>
          </label>
        </p>
      </div>
      <div class="col s12" style="margin-top:16px;">
        <a class="btn modal-trigger" href="#seatModal">Choose Seats</a>
      </div>
    </div>
  </div>

  <!-- Seat Picker Modal -->
  <div id="seatModal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h5>Seat Picker</h5>
      <p class="grey-text text-darken-1" style="margin-top:-4px;">
        First: rows 1–6 (1–2–1), Business: 7–20 (1–2–1), Premium: 25–27 (2–4–2), Economy: 30–40 (3–4–3)
      </p>

      <!-- Cabin headers injected here -->
      <div id="cabinContainer"></div>

      <!-- Seat map -->
      <div id="seatMap" class="seat-map" aria-label="Seat map" role="application"></div>

      <!-- Legend -->
      <div class="legend">
        <span><span class="box selected"></span> Selected</span>
        <span><span class="box disabled"></span> Taken / Unavailable</span>
      </div>
      <div class="legend">
        <span><span class="box" style="background:#1e88e5"></span> First Class</span>
        <span><span class="box" style="background:#fb8c00"></span> Business Class</span>
        <span><span class="box" style="background:#7e57c2"></span> Premium Economy</span>
        <span><span class="box" style="background:#43a047"></span> Economy</span>
      </div>

      <!-- Selected summary -->
      <div class="selection-summary">
        <h6>Selected seats</h6>
        <div id="selectedChips" class="chips"></div>
        <p id="summaryText" class="grey-text text-darken-1"></p>
      </div>
    </div>

    <div class="modal-footer">
      <a id="clearBtn" class="btn-flat">Clear</a>
      <a class="modal-close btn">Done</a>
    </div>
  </div>

  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script>
    const seatMapEl = document.getElementById('seatMap');
    const cabinContainerEl = document.getElementById('cabinContainer');
    const clearBtn = document.getElementById('clearBtn');
    const selectedChipsEl = document.getElementById('selectedChips');
    const summaryText = document.getElementById('summaryText');

    // Cabin definitions (FIRST + BUSINESS separated)
    const CABINS = [
      {
        key: 'first',
        name: 'First Class',
        className: 'first',
        startRow: 1,
        endRow: 6,
        // 1–2–1: A / D G / K
        letters: ['A', '', 'D', 'G', '', 'K']
      },
      {
        key: 'business',
        name: 'Business Class',
        className: 'business',
        startRow: 7,
        endRow: 20,
        // 1–2–1: A / D G / K
        letters: ['A', '', 'D', 'G', '', 'K']
      },
      {
        key: 'premium',
        name: 'Premium Economy',
        className: 'premium',
        startRow: 25,
        endRow: 27,
        // 2–4–2: A B / D E F G / J K
        letters: ['A','B','','D','E','F','G','','J','K']
      },
      {
        key: 'economy',
        name: 'Economy',
        className: 'economy',
        startRow: 30,
        endRow: 40,
        // 3–4–3: A B C / D E F G / H J K
        letters: ['A','B','C','','D','E','F','G','','H','J','K']
      }
    ];

    let selectedSeats = new Set();
    let lastClickedSeat = null;
    let currentFilterKey = 'all'; // 'all' or cabin key

    function createCabinHeader(name, rowsText, className, key) {
      const wrap = document.createElement('div');
      wrap.className = 'cabin-header ' + className;
      wrap.setAttribute('data-cabin-key', key);
      const title = document.createElement('h6');
      title.textContent = name + ' (' + rowsText + ')';
      const line = document.createElement('div');
      line.className = 'line';
      wrap.appendChild(title);
      wrap.appendChild(line);
      return wrap;
    }

    function generateMultiCabinLayout() {
      seatMapEl.innerHTML = '';
      cabinContainerEl.innerHTML = '';
      selectedSeats.clear();
      updateSummary();

      CABINS.forEach(cabin => {
        const rowsText = cabin.startRow + '–' + cabin.endRow;
        const headerEl = createCabinHeader(cabin.name, rowsText, cabin.className, cabin.key);
        cabinContainerEl.appendChild(headerEl);

        for (let r = cabin.startRow; r <= cabin.endRow; r++) {
          const rowEl = document.createElement('div');
          rowEl.className = 'seat-row';
          rowEl.setAttribute('data-row', r);
          rowEl.setAttribute('data-cabin', cabin.name);
          rowEl.setAttribute('data-cabin-key', cabin.key);

          const rowLabel = document.createElement('div');
          rowLabel.className = 'row-label';
          rowLabel.textContent = r;
          rowEl.appendChild(rowLabel);

          cabin.letters.forEach(part => {
            if (part === '') {
              const aisle = document.createElement('div');
              aisle.className = 'aisle';
              rowEl.appendChild(aisle);
              return;
            }

            const seatId = `${r}${part}`;
            const seatBtn = document.createElement('button');
            seatBtn.type = 'button';
            seatBtn.className = 'seat ' + cabin.className;
            seatBtn.textContent = part;
            seatBtn.setAttribute('data-seat', seatId);
            seatBtn.setAttribute('data-cabin', cabin.name);
            seatBtn.setAttribute('data-cabin-key', cabin.key);
            seatBtn.setAttribute('aria-pressed', 'false');
            seatBtn.setAttribute('title', `${seatId} – ${cabin.name}`);
            seatBtn.setAttribute('aria-label', `Seat ${seatId} in ${cabin.name}`);

            seatBtn.addEventListener('click', (ev) => onSeatClick(ev, seatBtn));
            seatBtn.addEventListener('keydown', (ev) => {
              if (ev.key === 'Enter' || ev.key === ' ') {
                ev.preventDefault();
                seatBtn.click();
              }
            });

            rowEl.appendChild(seatBtn);
          });

          seatMapEl.appendChild(rowEl);
        }
      });

      applyCabinFilter(currentFilterKey);
    }

    function onSeatClick(ev, seatBtn) {
      if (seatBtn.classList.contains('disabled')) return;

      const seatId = seatBtn.getAttribute('data-seat');

      if (ev.shiftKey && lastClickedSeat) {
        const allSeats = Array.from(document.querySelectorAll('.seat')).filter(s => !s.classList.contains('disabled'));
        const ids = allSeats.map(s => s.getAttribute('data-seat'));
        const i1 = ids.indexOf(lastClickedSeat);
        const i2 = ids.indexOf(seatId);
        if (i1 >= 0 && i2 >= 0) {
          const [start, end] = i1 < i2 ? [i1, i2] : [i2, i1];
          for (let i = start; i <= end; i++) {
            const s = allSeats[i];
            toggleSeatSelection(s, true);
          }
        }
      } else {
        toggleSeatSelection(seatBtn, null);
      }

      lastClickedSeat = seatId;
      updateSummary();
    }

    function toggleSeatSelection(seatEl, forceSelect = null) {
      const seatId = seatEl.getAttribute('data-seat');
      const isSelected = seatEl.classList.contains('selected');
      const shouldSelect = forceSelect === null ? !isSelected : Boolean(forceSelect);

      if (shouldSelect) {
        seatEl.classList.add('selected');
        seatEl.setAttribute('aria-pressed', 'true');
        selectedSeats.add(seatId);
      } else {
        seatEl.classList.remove('selected');
        seatEl.setAttribute('aria-pressed', 'false');
        selectedSeats.delete(seatId);
      }
    }

    function updateSummary() {
      selectedChipsEl.innerHTML = '';

      const seats = Array.from(selectedSeats).sort((a,b) => {
        const re = /^(\d+)(.+)$/;
        const ma = a.match(re);
        const mb = b.match(re);
        const ra = parseInt(ma[1],10), rb = parseInt(mb[1],10);
        if (ra !== rb) return ra - rb;
        return ma[2].localeCompare(mb[2]);
      });

      seats.forEach(s => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = s;
        const close = document.createElement('i');
        close.className = 'close material-icons';
        close.textContent = 'close';
        close.style.cursor = 'pointer';
        close.addEventListener('click', () => {
          const el = document.querySelector(`[data-seat="${s}"]`);
          if (el) toggleSeatSelection(el, false);
          updateSummary();
        });
        chip.appendChild(close);
        selectedChipsEl.appendChild(chip);
      });

      if (seats.length === 0) {
        summaryText.textContent = 'No seats selected.';
      } else if (seats.length === 1) {
        summaryText.textContent = `You selected seat ${seats[0]}.`;
      } else {
        summaryText.textContent = `You selected ${seats.length} seats: ${seats.join(', ')}.`;
      }
    }

    function clearSelections() {
      document.querySelectorAll('.seat.selected').forEach(s => {
        s.classList.remove('selected');
        s.setAttribute('aria-pressed', 'false');
      });
      selectedSeats.clear();
      updateSummary();
    }

    function applyCabinFilter(filterKey) {
      currentFilterKey = filterKey || 'all';

      const rows = document.querySelectorAll('.seat-row');
      const headers = document.querySelectorAll('.cabin-header');

      rows.forEach(row => {
        const key = row.getAttribute('data-cabin-key');
        if (currentFilterKey === 'all' || key === currentFilterKey) {
          row.style.display = 'flex';
        } else {
          row.style.display = 'none';
        }
      });

      headers.forEach(header => {
        const key = header.getAttribute('data-cabin-key');
        if (currentFilterKey === 'all' || key === currentFilterKey) {
          header.style.display = 'flex';
        } else {
          header.style.display = 'none';
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Init Materialize modal
      const elems = document.querySelectorAll('.modal');
      M.Modal.init(elems);

      // Build seat layout
      generateMultiCabinLayout();

      // Cabin filter radio events
      document.querySelectorAll('input[name="cabinFilter"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          applyCabinFilter(e.target.value);
        });
      });

      // Apply initial filter
      const initial = document.querySelector('input[name="cabinFilter"]:checked');
      if (initial) applyCabinFilter(initial.value);
    });

    clearBtn.addEventListener('click', () => {
      clearSelections();
    });

    // Expose for integration with backend:
    window.getSelectedSeats = () => Array.from(selectedSeats).sort();
  </script>
</body>
</html>
